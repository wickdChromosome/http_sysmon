<html>

	<head>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>




	</head>

	<body>

		<h1> Generated token: <p id="token_placeholder"></p></h1>

		<h1> Click here to register a new session with a new token </h1>
		<button onclick="generate_token()">Click me</button>

		<h1> Click here to start a new monitoring session </h1>
		<button onclick="start_monitoring()">Click me</button>


		<canvas id="line-chart" width="800" height="450"></canvas>
		<script>

		var ctx = document.getElementById("line-chart").getContext("2d");
		var myChart = new Chart(ctx, {
		  type: 'line',
		  data: {
		    datasets: [{
		      type: 'line',
		      label: '5 min Load avg/Number of cores',
						    data: [{x:0,y:0.4},{x:12,y:0.5}],
		      borderColor: 'red',
		      backgroundColor: 'red',
		      borderWidth: 2,
		      fill: false,
		    }, {
		      type: 'line',
		      label: '% RAM in use',
						    data: [{x:0,y:1.2},{x:17,y:1.4}],
		      borderColor: 'green',
		      backgroundColor: 'green',
		      borderWidth: 2,
		      fill: false,
		      xAxisID: 'x-axis-2',
		    }]
		  },
		  options: {
		    responsive: true,
		    title: {
		      display: true,
		      text: 'Pejlab server'
		    },
		    tooltips: {
		      mode: 'nearest',
		      intersect: true,
		    },
		    scales: {
		      xAxes: [{
			gridLines: {
			  offsetGridLines: false,
			}
		      }, {
			id: 'x-axis-2',
			type: 'linear',
			position: 'bottom',
			display: false,
			ticks: {
			  min: 0,
			  max: 600,
			  stepSize: 20
			}
		      }],
		      yAxes: [{
			ticks: {
			  min: 0,
			  max: 1.8
			}
		      }]
		    }
		  }
		});



		</script>
	</body>

	<script>

		function start_monitoring(token) {

			var interval = 1000;  // 1000 = 1 second, 3000 = 3 seconds
			function doAjax() {
			    $.ajax({
				    type: 'POST',
				    url: 'monitor',
				    data: {
				        access_token:token
				    },
				    dataType: 'json',
				    success: function (data) {
					    $('#hidden').val(data);// first set the value     
				    },
				    complete: function (data) {
					    // Schedule the next
					    setTimeout(doAjax, interval);
				    }
			    });
			} setTimeout(doAjax, interval);	

		}


		function register_session(token) {
		
			$.ajax({
				url: '/reg',
				type: 'post',
				data: {
        				access_token: token
    				},
				dataType: 'json',
				success: function (data) {
					console.log(data);
				}
			});
							
		}


		function generate_token() {


			var token = "";
			$.ajax({
				url: '/gentoken',
				type: 'get',
				success: function (data) {
					console.log(data);
					document.getElementById('token_placeholder').innerHTML = data;
					register_session(data);
				}
			});
					
		}



	</script>


</html>
